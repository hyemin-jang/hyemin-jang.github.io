---
title: '[Java] DBì—°ë™ê³¼ Connection Pool'
date: 2021-09-05 13:08:79
category: 'TIL - Playdata'
thumbnail: { thumbnailSrc }
draft: false
---





## Connection Poolì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

- ìë°” í”„ë¡œê·¸ë¨ì—ì„œ DBMSë¡œ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ë ¤ë©´ ì‹œê°„ì´ ë§ì´ ê±¸ë¦°ë‹¤.

- ì‚¬ìš©ìê°€ ì ‘ì†í•  ë•Œë§ˆë‹¤ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ë©´ ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

- ê·¸ë˜ì„œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•¨ê³¼ ë™ì‹œì— **ì»¤ë„¥ì…˜ í’€ì— ì¼ì • ê°œìˆ˜ì˜ DB ì»¤ë„¥ì…˜ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘”ë‹¤.** (Pool - ì„œë²„ì— ì´ë¯¸ ë‚´ì¥ëœ ë©”ëª¨ë¦¬)

- ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê° ìŠ¤ë ˆë“œì—ì„œ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ì§€ ì•Šê³ , ì»¤ë„¥ì…˜í’€ì˜ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ í• ë‹¹ë°›ì•„ ì‚¬ìš©í•œ ë’¤ ë°˜ë‚©í•œë‹¤


![img](https://t1.daumcdn.net/cfile/tistory/2629B3375492CD3E10)

[ì´ë¯¸ì§€ ì¶œì²˜] https://devbox.tistory.com/entry/JSP-%EC%BB%A4%EB%84%A5%EC%85%98-%ED%92%80-1





## Connection Pool ë§Œë“¤ê¸°

### (1)  DataSource

- ìë°” ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì»¤ë„¥ì…˜í’€ ê°ì²´ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ìŠ¤í™ì„ ì •ì˜í•´ë†“ì€ ì¸í„°í˜ì´ìŠ¤ =  `javax.sql.DataSource`
- **DataSource ê°ì²´ì— DBì—°ê²°ì— í•„ìš”í•œ URL, ID, Password, DriverClassë¥¼ ë¯¸ë¦¬ ì •ì˜í•´ë†“ê³  ì‚¬ìš©**í•œë‹¤ - DBì—°ê²°ì‹œë§ˆë‹¤ í•´ë‹¹ ì •ë³´ë¥¼ ë§¤ë²ˆ ì…ë ¥í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ í•´ì†Œ



### (2)  JNDI (Java Naming and Directory Interface)

- ë¶„ì‚°ëœ ê°ì²´ë¥¼ ì°¾ê¸°ìœ„í•´ **íŠ¹ì •í•œ ì´ë¦„ìœ¼ë¡œ ê°ì²´ë¥¼ ë“±ë¡í•´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ** í•´ì£¼ëŠ” ìë°” API
- Tomcatê³¼ ê°™ì€ WASì—ì„œëŠ” íŠ¹ì • í´ë”ì— í•„ìš”í•œ ë°ì´í„° ì†ŒìŠ¤(ë¼ì´ë¸ŒëŸ¬ë¦¬)ê°€ ìˆëŠ”ë° ê·¸ê²ƒì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ JNDI ê¸°ìˆ ì„ í™œìš©í•œë‹¤.
- ë¯¸ë¦¬ ì§€ì •í•œ ì´ë¦„(`name`)ì„ ì°¾ì•„ì„œ(`lookup`) í™œìš©í•˜ë©´ ëœë‹¤.
- `Initialcontext`ëŠ” JNDI namespaceì˜ ëª¨ë“  ëª…ëª…ëœ ê°ì²´ë¥¼ ì°¾ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê°ì²´



### ğŸ’ Tomcatì—ì„œ JNDI í™œìš©í•´ì„œ DBì—°ê²°í•˜ê¸°

- `context.xml` íŒŒì¼ì— ì»¤ë„¥ì…˜í’€ì„ ë§Œë“œëŠ” DataSource ë¦¬ì†ŒìŠ¤ë¥¼ ë“±ë¡í•œë‹¤.

- JNDIê¸°ìˆ ì„ í†µí•´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ì´ë¦„ì„ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•œë‹¤.

- DataSourceëŠ” ì‚¬ìš©ì ìš”ì²­ì´ ìˆì„ ë•Œë§ˆë‹¤ Connectionì„ ì œê³µí•œë‹¤.

    



## ì›¹ í”„ë¡œì íŠ¸ì—ì„œ DB ì—°ë™í•˜ê¸°

### 1) JDBC ì‚¬ìš©

1. JDBC Driver ì„¤ì •

   - ì˜¤ë¼í´ 11g xe ê¸°ì¤€ -`ojdbc6.jar`íŒŒì¼ì„ `WebContent\WEP-INF\lib` í´ë”ì— ë„£ëŠ”ë‹¤

   

2. ì»¤ë„¥ì…˜í’€ì— ëŒ€í•œ ì •ë³´ë¥¼ DataSourceì— ì„¤ì •

   - ì²«ë²ˆì§¸ ë°©ë²•) `Servers\Tomcat v9.0 Server at localhost-config\context.xml` íŒŒì¼ì— ì„¤ì •í•´ë„ ë˜ê³ ,

   - ë‘ë²ˆì§¸ ë°©ë²•) `Servers\Tomcat v9.0 Server at localhost-config\context.xml`ì„ ë³µì‚¬í•´ì„œ í˜„ í”„ë¡œì íŠ¸ì˜ `META-INF` í•˜ë‹¨ì— ë¶™ì—¬ë„£ê¸° í›„ í¸ì§‘í•´ë„ ëœë‹¤. 

     

   í”„ë¡œì íŠ¸ë§ˆë‹¤ ì„¤ì •í•˜ëŠ” ê²ƒì´ ë” ì•ˆì •ì ì´ë¯€ë¡œ ë‘ë²ˆì§¸ ë°©ë²•ìœ¼ë¡œ í•˜ê² ë‹¤.

   <br>

   <META-INF \ context.xml>

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <Context>
   	<Resource name="jdbc/myoracle" 
                 auth="Container"
                 type="javax.sql.DataSource" 
                 driverClassName="oracle.jdbc.OracleDriver"
                 url="jdbc:oracle:thin:@127.0.0.1:1521:xe"
                 username="SCOTT" password="TIGER" 
                 maxTotal="20" 
                 maxIdle="10"
                 maxWaitMillis="-1"/>
   </Context>
   ```

   ìœ„ì™€ ê°™ì´ ì´ë ‡ê²Œ **ì´ë¦„ì´ "jdbc/myoracle"ì´ê³ , ì¢…ë¥˜ëŠ” DataSourceì¸** resourceë¥¼ ìƒì„±í•˜ì˜€ë‹¤.

   <br>

   âœ… Resource ì„¤ì •ê°’ ì„¤ëª…

   | ì»¤ë„¥ì…˜í’€ ì„¤ì •ê°’          | ì„¤ëª…                                                         |
   | ------------------------ | ------------------------------------------------------------ |
   | initialSize              | ìµœì´ˆë¡œ ì»¤ë„¥ì…˜í’€ ìƒì„± ì‹œ ë§Œë“¤ Connection ê°ì²´ì˜ ìˆ˜ (ê¸°ë³¸ê°’ 0) |
   | minIdle                  | ìµœì†Œí•œìœ¼ë¡œ ìœ ì§€ë  Connection ê°ì²´ì˜ ìˆ˜ (ê¸°ë³¸ê°’ 0)            |
   | maxIdle                  | ì»¤ë„¥ì…˜í’€ì— ë°˜ë‚©ëœ ìœ íœ´ Connection ê°ì²´ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ê°’ (ê¸°ë³¸ê°’ 8) |
   | maxTotal (= maxActive)   | ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì»¤ë„¥ì…˜ ê°¯ìˆ˜ (ê¸°ë³¸ê°’ 8)            |
   | maxWaitMillis (=maxWait) | í• ë‹¹ë°›ì„ Connection ê°ì²´ê°€ ì—†ì„ ë•Œ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡ì‹œí‚¬ ì‹œê°„ (1/1000ì´ˆ ë‹¨ìœ„) / -1 : ë¬´í•œ ëŒ€ê¸° ì˜ë¯¸ |

   â€‹	 

3. .java í˜¹ì€ .jsp íŒŒì¼ì—ì„œ ì‚¬ìš©

   <DButil.java>

   ```java
   package util;
   
   import javax.naming.Context;
   import javax.naming.InitialContext;
   import javax.naming.NamingException;
   import javax.sql.DataSource;
   import java.sql.Connection;
   
   public class DBUtil {
   
   	// datasourceëŠ” static ë©¤ë²„ë³€ìˆ˜ë¡œ ì„¤ì • - í•˜ë‚˜ì˜ ê°ì²´ë§Œ ìƒì„±
       private static DataSource ds;   
   	
   	static {
   		try {
               // InitialContextê°€ ìƒì„±ë˜ë©´ì„œ context.xmlì— ì €ì¥ëœ ì •ë³´ë¥¼ ì½ì–´ì˜¨ë‹¤
               Context initContext = new InitialContext(); 
   			
               // "java:/comp/env" = java environmentìƒì˜ component(=ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ê°ì²´)
               // ìë°” ì‹¤í–‰í™˜ê²½ ë‚´ë¶€ì— ì €ì¥ëœ ìì›ì„ ê²€ìƒ‰í•´ì„œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ëœ»
               Context envContext  = (Context)initContext.lookup("java:/comp/env");  
   			
               // "jdbc/myoracle" ì´ë¦„ìœ¼ë¡œ ë˜ì–´ìˆëŠ” ìì›(ì¦‰ Datasource)ì„ dsë¼ëŠ” ë³€ìˆ˜ëª…ìœ¼ë¡œ ì‚¬ìš©
               ds = (DataSource)envContext.lookup("jdbc/myoracle");
               
           } catch (NamingException e) {
               e.printStackTrace();
           }
   		
   	}
   
   	// getConnection() ë©”ì†Œë“œ ì‹¤í–‰ì‹œë§ˆë‹¤ ì»¤ë„¥ì…˜í’€ë¡œë¶€í„° ì»¤ë„¥ì…˜ ë°›ì•„ì˜¤ëŠ” ë©”ì†Œë“œ
   	public static Connection getConnection() throws SQLException {
           return ds.getConnection();  
       }
   
   }
   ```
   



<br>

### 2) JPA ì‚¬ìš©

1. í”„ë¡œì íŠ¸ë¥¼ JPA í”„ë¡œì íŠ¸ë¡œ ë³€í™˜ 
2. í”„ë¡œì íŠ¸ë¥¼ Maven í”„ë¡œì íŠ¸ë¡œ ë³€í™˜ 
   - `pom.xml` ì„¤ì •íŒŒì¼ ìˆ˜ì •í•˜ì—¬ oracle Driver ë“±ë¡ ë° javax.persistence, org.hibernate ë“±ë¡ 
   - lombok, slf4j ë“±ë“±ë„ ë“±ë¡í•´ì„œ ì‚¬ìš©

3. `persistence.xml` ì„¤ì •íŒŒì¼ ìˆ˜ì • (1~3ë²ˆ ê³¼ì •  ì´ì „ í¬ìŠ¤íŒ… ì°¸ê³  - [[Java] 12. JPA](https://hyemin-jang.github.io/Java/12.JPA/) )

4. .java í˜¹ì€ .jsp íŒŒì¼ì—ì„œ ì‚¬ìš©

   <DBUtil.java>

   ```java
   package util;
   
   import java.sql.SQLException;
   import javax.persistence.EntityManager;
   import javax.persistence.EntityManagerFactory;
   import javax.persistence.Persistence;
   
   public class DBUtil {
       private static EntityManagerFactory emf;
       
       static {
           emf = Persistence.createEntityManagerFactory("myoracle");
           // EntityManagerFactoryëŠ” ì›¹ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë¡œë”©ë˜ëŠ” ì‹œì ì— ë”± í•œê°œë§Œ ìƒì„±
           // ì‚¬ìš©ì ìš”ì²­ì‹œë§ˆë‹¤(=ìŠ¤ë ˆë“œ í•˜ë‚˜ ìƒì„±ë ë•Œë§ˆë‹¤) EntityManagerë¥¼ ìƒì„±, ê´€ë¦¬
           // JDBCì˜ Connection Poolê³¼ ê°™ë‹¤ê³  ìƒê°í•˜ë©´ ë¨
       }
       
       public static EntityManager getEntityManager() throws SQLException {
           return emf.createEntityManager();
           // EntityManagerëŠ” ìŠ¤ë ˆë“œ ê°„ì— ê³µìœ ë˜ì§€ ì•ŠìŒ
           // ì—”í‹°í‹°ì™€ ê´€ë ¨ëœ ëª¨ë“  ì¼(CRUD) ì²˜ë¦¬
           // JDBCì˜ Connection ê°ì²´ì™€ ê°™ë‹¤ê³  ìƒê°í•˜ë©´ ë¨
       }
       
       public static void close() {
           emf.close();
           emf = null;
       }
   
   }
   ```
   
   



